{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/changelists.css" %}">
  <style>
    .statistics-container {
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      max-width: 100%;
      overflow-x: auto;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .stats-card {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stats-value {
      font-size: 24px;
      font-weight: bold;
      color: #28a745;
      margin-bottom: 5px;
    }
    .stats-label {
      color: #6c757d;
      font-size: 14px;
    }
    .chart-container {
      margin: 20px 0;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow-x: auto;
    }
    .responsive-table {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
    .statistics-section {
      margin-bottom: 30px;
    }
    .chart-container {
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #dee2e6;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #dee2e6;
    }
    th {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .stat-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #28a745;
    }
    .stat-label {
      color: #6c757d;
      font-size: 14px;
    }
  </style>
{% endblock %}

{% block content %}
<div id="content-main">
  <div class="statistics-container">
    <h2>Общая статистика продаж</h2>
      
      <h3>Годовая статистика</h3>
      <table>
        <tr>
          <th>Год</th>
          <th>Количество продаж</th>
          <th>Общая выручка</th>
          <th>Чистая прибыль</th>
        </tr>
        {% for stat in yearly_stats %}
          <tr>
            <td>{{ stat.year|date:"Y" }}</td>
            <td>{{ stat.total_sales }}</td>
            <td>{{ stat.total_revenue|floatformat:2 }} сом</td>
            <td>{{ stat.net_revenue|floatformat:2 }} сом</td>
          </tr>
        {% endfor %}
      </table>
      
      <h3>Месячная статистика</h3>
      <table>
        <tr>
          <th>Месяц</th>
          <th>Количество продаж</th>
          <th>Общая выручка</th>
          <th>Чистая прибыль</th>
        </tr>
        {% for stat in monthly_stats %}
          <tr>
            <td>{{ stat.month|date:"F Y" }}</td>
            <td>{{ stat.total_sales }}</td>
            <td>{{ stat.total_revenue|floatformat:2 }} сом</td>
            <td>{{ stat.net_revenue|floatformat:2 }} сом</td>
          </tr>
        {% endfor %}
      </table>
      
      <h3>Графики статистики</h3>
      <div>
        {{ sales_chart|safe }}
      </div>
      <div>
        {{ revenue_chart|safe }}
      </div>
      
      <h3>Ежедневная статистика</h3>
      <table>
        <tr>
          <th>Дата</th>
          <th>Количество продаж</th>
          <th>Общая выручка</th>
          <th>Стоимость доставки</th>
          <th>Чистая прибыль</th>
        </tr>
        {% for stat in daily_stats %}
          <tr>
            <td>{{ stat.date|date:"d.m.Y" }}</td>
            <td>{{ stat.total_sales }}</td>
            <td>{{ stat.total_revenue|floatformat:2 }} сом</td>
            <td>{{ stat.total_delivery|floatformat:2 }} сом</td>
            <td>{{ stat.net_revenue|floatformat:2 }} сом</td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>
{% endblock %}
